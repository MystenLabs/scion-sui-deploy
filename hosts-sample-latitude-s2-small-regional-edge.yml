---
#
# This is a sample file for setting up a Regional Edge (standalone Edge VM) on Latitude s2-small.
# It is provided as a reference.
# This set up requires a second IPv4 address provided by Latitude.
# This has not been tested using IPv6.
# Ideally, the bare metal could use the provided IPv6 and the VM the IPv4.
#
# Install sets to run this playbook locally on the Latitude s2-small:
# git clone https://github.com/MystenLabs/scion-sui-deploy.git
# cd scion-sui-deploy
# curl -sSL https://install.python-poetry.org | python3 -
# export PATH="~$USER/.local/bin:$PATH"
# poetry install --no-root
# poetry run ansible-galaxy install -r ansible/requirements.yml
# cp hosts-sample-latitude-s2-small-regional-edge.yml hosts.yml
# vi hosts.yml
# vi config.yml
# poetry run ansible-playbook -i hosts.yml ansible/shared-edge.yml --connection=local
# virsh list
# virsh console <edge_name>
#


# The bare-metal hosts that will be hosting the EDGE VM.
bare_metal_hosts:
  hosts:
    baremetal-suival:

# The inventory hostname used to refer to the edge.
edge_vms:
  hosts:
    edge:

all:
  vars:
    # SSH authorized keys that are added to the EDGE VM.
    ssh_authorized_keys:
      - ""

regionA:
  hosts:
    baremetal-suival:
      # -- SSH options
      # running this locally as ubuntu
      ansible_host: "localhost"
      # this username needs to have SSH login privileges (SSH key setup) on the ansible_host setup above.
      # (not applicable when running locally)
      ansible_user: "ubuntu"

      # -- Configuration
      # Public network interface that will be shared with the EDGE VM.
      # This could be a physical interface or a bond of multiple physical interfaces
      public_interface: "enp1s0f1"
      # Public IPv4 address of the bare metal OS
      public_ipv4: "185.26.11.27"
      public_ipv4_cidr: "185.26.11.27/31"
      public_ipv4_gateway: "185.26.11.26"

      public_ipv6: "2605:6441:2001:a13::2"
      public_ipv6_cidr: "2605:6441:2001:a13::2/64"
      public_ipv6_gateway: "2605:6441:2001:a13::1"
      # The inventory hostname of the hosted EDGE
      hosted_edge: edge

      # -- VM resource configuration
      # if empty, default values of vcpu=2 and vm_memory_mib=2048 will be used.
      vm_memory_mib: 16384
      vm_vcpus: 4


    edge:
      # -- SSH options
      # Uses the bare-metal as a jump host to SSH into the hosted EDGE VM, does not need to be changed.
      ansible_user: anapaya
      ansible_host: 192.168.18.2
      ansible_ssh_common_args: "-J {{ hostvars[vm_host]['ansible_user'] ~ '@' ~ hostvars[vm_host]['ansible_host'] }}"

      # -- Configuration
      # Inventory hostname of the bare-metal host associated with this EDGE VM
      vm_host: baremetal-suival
      # IP and gateway for the EDGE appliance.
      network_config:
        # This is a secondary IP address/netmask to be dedicated to the Edge.
        ipv4_cidr: "67.213.117.1/31"
        gateway: "67.213.117.0"

      # Public IPv4 address to be configured on the EDGE.
      # Defaults to the network address above without the CIDR range.
      public_ipv4: "{{ network_config.ipv4_cidr | ansible.utils.ipaddr('address') }}"

  vars:
    dns:
      - address: 1.1.1.1
      - address: 8.8.8.8
      - address: 2001:4860:4860::8844
      - address: 2001:4860:4860::8888

    metrics_labels:
      product: "edge"
      #appliance: "<hostname>.appliance"
      #project: "sui-scion-<network>"
      #shortname: "<hostname>-edge"
    appliance_hostname: "GB-CL-TN-01"

    # set to 'dedicated' to run an edge vm on the validator host.
    # This will also deploy frr/bgp on the bare metal host to peer with the edge vm
    # 'shared' mode will run an edge vm on a separate host.
    # deploy_type: dedicated

    # Enable logging to Loki from the edge appliance.
    # logging_url: "<loki_url>"

    # in 'dedicated' deployment types,if the bare metal host and edge
    # appliance have IP's on different subnets, you will want to uncomment this
    # ebgp_multihop: 2

    # Directory in which secret values are stored on the controller
    secrets_dir: "/tmp"
    # Directory of the deployment package provided by Mysten Labs
    deployment_package_path: "/home/ubuntu/scion-sui-deploy"

    # uncomment to use bgp only bridge
    # deploy_edge_metal_bgp_only_bridge: true
    # Paths derived from the above
    deployment_package_config: "{{ deployment_package_path }}/config.yml"
    scion_trcs_path: "{{ deployment_package_path }}/trcs"
    scion_certificate_path: "{{ deployment_package_path }}/scion-cert.pem"
    scion_forwarding_key_path: "{{ secrets_dir }}/forwarding-key.key"
    scion_private_key_path: "{{ secrets_dir }}/scion-private-key.key"


